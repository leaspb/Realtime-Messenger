# Эксплуатация (Runbook)

## Наблюдаемость

Минимальный набор мониторинга:
1. HTTP доступность (`GET /api/health`).
2. Количество активных WebSocket соединений.
3. Логи ошибок WebSocket/WebRTC.
4. Ресурсы процесса (CPU/RAM), особенно при росте размера комнат.

## Типовые инциденты и действия

### 1. Приложение не стартует

Симптом: ошибка `DATABASE_URL must be set`.

Действия:
1. Проверить наличие `DATABASE_URL` в окружении процесса.
2. Проверить доступность PostgreSQL и корректность строки подключения.

### 2. Пользователи не слышат друг друга

Действия:
1. Проверить права браузера на микрофон.
2. Проверить, что соединение идет по HTTPS/WSS (внешние окружения).
3. Проверить, проходят ли signaling сообщения `offer/answer/candidate`.
4. Проверить NAT/firewall ограничения; при необходимости добавить TURN сервер.

### 3. Пользователь видит "Disconnected"

Действия:
1. Проверить стабильность сети клиента.
2. Проверить reverse proxy настройки для WebSocket Upgrade.
3. Проверить логи backend на исключения в обработчике `wss.on('connection')`.

### 4. Деградация производительности в больших комнатах

Причина: mesh WebRTC топология.

Действия:
1. Ограничить максимальный размер комнаты.
2. Перейти на SFU архитектуру для медиа-трафика.
3. Вынести signaling state в внешний стор (Redis + pub/sub) для масштабирования.

## Операционные чек-листы

### Перед релизом
1. `npm run check`
2. `npm run build`
3. Проверка `/api/health`
4. Smoke test комнаты (2+ участника)

### После релиза
1. Проверка startup логов без исключений
2. Проверка WebSocket подключения из браузера
3. Проверка текстового сообщения и голосового вызова
